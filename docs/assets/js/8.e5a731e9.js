(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{212:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker compose")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#docker-compose-yml"}},[s._v("docker-compose.yml")])]),a("li",[a("a",{attrs:{href:"#запуск-отдеnьного-сервиса-из-docker-compose-yml"}},[s._v("Запуск отдельного сервиса из docker-compose.yml")])]),a("li",[a("a",{attrs:{href:"#volumes"}},[s._v("Volumes")])]),a("li",[a("a",{attrs:{href:"#dockers-commands"}},[s._v("Dockers commands")])]),a("li",[a("a",{attrs:{href:"#автоматическая-перегрузка-контейнеров-restarts"}},[s._v("Автоматическая перегрузка контейнеров (restarts)")])]),a("li",[a("a",{attrs:{href:"#создание-допоnнитеnьных-сервисов-scale-nginx-load-balancer"}},[s._v("Создание дополнительных сервисов (scale, nginx, load-balancer)")])])])]),a("p"),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[s._v("#")]),s._v(" docker-compose.yml")]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# when starting containers - docker automatically")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# makes network for specified services(containers)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# where they can see each other")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service same as container here")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis'")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node-app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4001:8081'")]),s._v("\n")])])]),a("br"),s._v(" "),a("h3",{attrs:{id:"запуск-отдеnьного-сервиса-из-docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#запуск-отдеnьного-сервиса-из-docker-compose-yml"}},[s._v("#")]),s._v(" Запуск отдельного сервиса из "),a("code",[s._v("docker-compose.yml")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose up [service-name]\n")])])]),a("br"),s._v(" "),a("h3",{attrs:{id:"volumes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volumes"}},[s._v("#")]),s._v(" Volumes")]),s._v(" "),a("p",[s._v("Указывает куда сохранять данные из БД из контейнера на локальную машину.\nДанные не храняться в контейнере, там храниться только ссылка")]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mongodb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongodb_sp_local"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MONGO_DATA_DIR=/data/db\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MONGO_LOG_DIR=/dev/null\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./data/db - сделает папку там где был запущент контейнер(то есть в проекте), ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# и данные из контейнера по ссылке буду сохраняться/цепляться при закрытии/запуске контейнера через docker-compose   ")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./data/db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data/db  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 28017"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongod "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("logpath=/dev/null "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --quiet")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" localnet\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n")])])]),a("br"),s._v(" "),a("h3",{attrs:{id:"dockers-commands"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockers-commands"}},[s._v("#")]),s._v(" Dockers commands")]),s._v(" "),a("h4",{attrs:{id:"docker-compose-up-build-build-services-and-run-em"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-up-build-build-services-and-run-em"}},[s._v("#")]),s._v(" "),a("code",[s._v("docker-compose up --build")]),s._v(" - build services and run em")]),s._v(" "),a("h4",{attrs:{id:"docker-compose-up-d-launch-in-background"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-up-d-launch-in-background"}},[s._v("#")]),s._v(" "),a("code",[s._v("docker-compose up -d")]),s._v(" - launch in background")]),s._v(" "),a("h4",{attrs:{id:"docker-compose-down-remove-containers-networks-and-etc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-down-remove-containers-networks-and-etc"}},[s._v("#")]),s._v(" "),a("code",[s._v("docker-compose down")]),s._v(" - remove containers, networks and etc.")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"автоматическая-перегрузка-контейнеров-restarts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#автоматическая-перегрузка-контейнеров-restarts"}},[s._v("#")]),s._v(" Автоматическая перегрузка контейнеров (restarts)")]),s._v(" "),a("p",[s._v("Коды при которых перегрузиться контейнер")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("0")]),s._v(" - ОК, это нормальный код окончания процесса (always)")]),s._v(" "),a("li",[a("code",[s._v("1, ...")]),s._v(" - от 1 и дальше, это уже ненормальное окончание процесса (on-failure)")])]),s._v(" "),a("p",[s._v("Restart policies:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v('"no"')]),s._v(" - never attempt to restart this . container if stops or crashes")]),s._v(" "),a("li",[a("code",[s._v("always")]),s._v(" - if this container stops "),a("em",[s._v("any reason")]),s._v(" always attempt to restart it")]),s._v(" "),a("li",[a("code",[s._v("on-failure")]),s._v(" - olny restart if container stops with an error code")]),s._v(" "),a("li",[a("code",[s._v("unless-stopped")]),s._v(" - always restart unless we (the developers) forcibly stop it")])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[a("strong",[s._v("'no'")]),s._v(" - должны быть в кавычках, потому что в "),a("code",[s._v("yml")]),s._v(" это как "),a("strong",[s._v("false")])])]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# when starting containers - docker automatically")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# makes network for specified services(containers)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# where they can connect each other")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service same as container here")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis'")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node-app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8000:8000'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n")])])]),a("br"),s._v(" "),a("h3",{attrs:{id:"создание-допоnнитеnьных-сервисов-scale-nginx-load-balancer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#создание-допоnнитеnьных-сервисов-scale-nginx-load-balancer"}},[s._v("#")]),s._v(" Создание дополнительных сервисов (scale, nginx, load-balancer)")]),s._v(" "),a("p",[s._v("Также надо изменить свой docker-compose в соотвествии с "),a("a",{attrs:{href:"https://pspdfkit.com/blog/2018/how-to-use-docker-compose-to-run-multiple-instances-of-a-service-in-development/",target:"_blank",rel:"noopener noreferrer"}},[s._v("инструкциями"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose up --scale web=3\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);